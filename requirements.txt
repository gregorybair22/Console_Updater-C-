Technical Test: Console Updater (C#) with Versioning, Locked-File Detection, and RollbackContextWe currently use a Windows .bat script (UpdateMD.bat) to update a desktop application by unpacking a release package, preserving the existing appsettings.json, creating a backup of the current installation, and deploying the new build. Your task is to implement an equivalent (but more robust) C# console updater that can be executed manually or scheduled/automated.This tool will be used to update a folder-based installation on Windows.GoalsBuild a .NET (C#) console application that:Updates an installation folder from a package source.Supports .zip, .rar, or an already-extracted folder as the source.Preserves the existing appsettings.json by copying it into the new build before deployment.Creates versioned backups before deployment.Detects and reports locked/open files (no access) and fails safely.Supports rollback to:the last backup, ora specific backup version.Is fully non-interactive by default (automation-friendly).Provides complete help output when ?/--help is used or on argument errors.DeliverablesA C# solution (recommended structure):Updater.Cli (console app)Updater.Core (optional library for deployment logic)README.md including:Build/run instructionsAll commands and options (same as --help)ExamplesExit codesRAR extraction approach and prerequisitesSource code with clean structure and robust error handling.(Optional but valued) Unit tests for:argument parsingversion selection logicinner-folder resolutionCommands & BehaviorCommand: updateDeploy a package to the destination folder, creating a backup first.High-level flow:Validate inputs.Prepare a unique temp folder.Expand the source (.zip/.rar/folder) into temp.Resolve the “inner folder” to deploy.Copy config from current installation into the new build (preserve config).Detect locked files in destination (fail before making changes).Move current installation into backup folder.Move new build into destination.Cleanup temp.Command: rollbackRestore destination folder from backups.Supported rollback modes:--last: rollback to most recent backup--to <versionId>: rollback to a specific version folder nameFlow:Validate destination and backup presence.Detect locked files in destination (fail before changes).Move current destination to a new backup (so rollback is also reversible).Move selected backup into destination.Command: list-versionsList available backup versions found in --backup-root, sorted by date.Should indicate which entry would be used by rollback --last.Command: help (and help triggers)Print full help.Must also trigger help when:user runs Updater.Cli ?, Updater.Cli -?, Updater.Cli --help, or Updater.Cli helpargument parsing fails (unknown option, missing value, invalid combination, unknown command)On argument errors:print a single-line error messagethen print full helpexit with code 1Supported InputsSource input--source <path> can be:path to .zippath to .rarpath to a folder containing extracted filesIf not provided, a default source path must be used (see Defaults section).Destination folder--dest <path> points to the installed application folder to replace.Backup root--backup-root <path> is where backups are stored.Inner Folder ResolutionThe current BAT expects a folder like net7.0-windows inside the extracted package.Your updater must support:--inner-folder <name> If specified, that exact folder must exist inside the expanded package and is deployed.If not specified, auto-detect:If the expanded root contains exactly one directory, deploy that directory.If it contains multiple directories, fail and print the detected folder names, suggesting --inner-folder.Config Preservation (appsettings.json)Default config file name: appsettings.json--preserve-config <true|false> (default: true) If enabled and destination exists, copy the config file from: dest\appsettings.json into the new build folder (inner folder) before deployment.--require-config <true|false> (default: false) If true and config does not exist in destination, fail.If --preserve-config=true but destination config is missing and --require-config=false, log a warning and continue.Locked / Open File DetectionBefore moving or replacing the destination folder, the tool must detect files that cannot be accessed (likely opened by another process).Requirement:Scan all files in --dest recursively.Attempt to open each file with exclusive access (e.g., FileShare.None).If any file cannot be opened, treat it as locked.Behavior:Print a clear list of locked file paths.Exit with a non-zero code (recommended exit code 2).Do not change anything (no backup, no deployment) if locked files exist.Archive SupportZIPUse built-in .NET APIs (System.IO.Compression).RARRAR is not supported by .NET out of the box. You must choose one:Option A (recommended): Use 7-Zip CLIRequire 7z.exe to be available (either in PATH or via a configurable option such as --sevenzip-path).Document the requirement in README and --help.Option B: Managed libraryAcceptable if reliable and licensed appropriately.Must be documented.Your tool must fail gracefully with a clear error if RAR extraction is requested but prerequisites are missing.Defaults (must be implemented)If the user runs Updater.Cli update with no options:--source default: .\net7.0-windows.rar--dest default: .\maquinasdispensadorasnuevosoftware--backup-root default: .\secur--config-file default: appsettings.json--inner-folder default: auto-detect (or optionally default to net7.0-windows if you want strict compatibility—document it)All defaults must be printed in --help.Exit CodesImplement consistent exit codes:0: success1: invalid arguments / validation error2: IO error / locked files3: extraction error (zip/rar/folder expansion)4: deploy/backup failure5: rollback failureLogging RequirementsConsole output must be clear and actionable.Include at least INFO/WARN/ERROR levels.Print a final summary on success:destination updatedbackup folder created (version id)source usedSafety / Robustness RequirementsNever overwrite an existing backup folder.Avoid partial states:if deployment fails, provide a clear, deterministic state and logs.Always clean temp folders when possible.Must run without user prompts (except printing help/errors).Help Output Requirements (Complete Help)When showing help (?, --help, or on parsing failure), print:Tool descriptionUsageCommands listGlobal optionsPer-command optionsDefaultsExit codesExamplesAlso support (recommended):Updater.Cli update --help → prints help for update commandUpdater.Cli rollback --help → prints help for rollback commandExample CLI UsageUpdater.Cli ?Updater.Cli --helpUpdater.Cli updateUpdater.Cli update --source update.zipUpdater.Cli update --source C:\releases\build.rar --inner-folder net7.0-windowsUpdater.Cli update --source C:\releases\staging\ --dest C:\App\InstallUpdater.Cli update --dry-run --source update.zipUpdater.Cli list-versions --backup-root .\securUpdater.Cli rollback --lastUpdater.Cli rollback --to maquinasdispensadorasnuevosoftware_20251225_221501Acceptance Checklist (Manual)Updater.Cli ? prints full help and exits 0.Updater.Cli update --unknown prints:one-line errorfull helpexits 1.update fails safely when files are locked and lists them, exits 2.update creates a backup folder and deploys new build successfully.rollback --last restores previous version.rollback --to <id> restores specified version.list-versions prints sorted backups and indicates latest.NotesAssume Windows environment.Keep the tool simple, deterministic, and easy to run from Task Scheduler.Document any external dependencies (especially for RAR extraction).
